name: ğŸš€ Advanced Auto Dashboard

on:
  push:
    branches: [main, master]

permissions:
  contents: write

jobs:
  update-readme:
    if: github.actor != 'github-actions[bot]'
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ“Š Count & Generate
        id: stats
        run: |
          LC=$(find leetcode -mindepth 1 -maxdepth 1 -type d 2>/dev/null | wc -l || echo 0)
          PR=0
          for D in í”„ë¡œê·¸ë˜ë¨¸ìŠ¤ programmers Programmers; do 
            [ -d "$D" ] && PR=$((PR+$(find "$D" -mindepth 1 -maxdepth 1 -type d 2>/dev/null | wc -l)))
          done
          BJ=0
          for D in ë°±ì¤€ baekjoon Baekjoon; do 
            [ -d "$D" ] && BJ=$((BJ+$(find "$D" -mindepth 1 -maxdepth 1 -type d 2>/dev/null | wc -l)))
          done

          echo "LC=$LC PR=$PR BJ=$BJ"
          echo "lc=$LC" >> $GITHUB_OUTPUT
          echo "pr=$PR" >> $GITHUB_OUTPUT
          echo "bj=$BJ" >> $GITHUB_OUTPUT

      - name: ğŸ“ Create Dashboard
        run: |
          echo "## ğŸ“Š Platform Statistics" > dashboard.md
          echo "" >> dashboard.md
          echo "| Platform | Count |" >> dashboard.md
          echo "|----------|-------|" >> dashboard.md
          echo "| ğŸŸ¡ LeetCode | ${{ steps.stats.outputs.lc }} |" >> dashboard.md
          echo "| ğŸ”µ Programmers | ${{ steps.stats.outputs.pr }} |" >> dashboard.md
          echo "| ğŸŸ¢ Baekjoon | ${{ steps.stats.outputs.bj }} |" >> dashboard.md
          echo "| ğŸ”¢ **Total** | $(( ${{ steps.stats.outputs.lc }} + ${{ steps.stats.outputs.pr }} + ${{ steps.stats.outputs.bj }} )) |" >> dashboard.md
          echo "" >> dashboard.md
          echo "## ğŸ¥‡ Recently Solved (Top 5)" >> dashboard.md
          echo "" >> dashboard.md
          git log -n 5 --oneline 2>/dev/null | sed 's/^/- /' >> dashboard.md || echo "- No commits" >> dashboard.md

      - name: ğŸ”„ Update README
        run: sed -i '/<!-- DASHBOARD-START -->/,/<!-- DASHBOARD-END -->/r dashboard.md' README.md

      - name: ğŸ’¾ Commit
        run: |
          git config --local user.name "github-actions[bot]"
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git add README.md
          
          if git diff --staged --quiet; then
            echo "â„¹ï¸ ë³€ê²½ì‚¬í•­ ì—†ìŒ"
          else
            git commit -m "ğŸš€ dashboard updated"
            git push