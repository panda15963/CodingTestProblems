name: Auto Update README Table

on:
  push:
    branches: [main, master]

permissions:
  contents: write

jobs:
  update-readme:
    # ðŸ¤– ë´‡ ì»¤ë°‹ì´ë©´ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ (ë¬´í•œ ë£¨í”„ ë°©ì§€)
    if: github.actor != 'github-actions[bot]'
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Generate table
        run: |
          echo "## ðŸ“Œ All Problems" > table.md
          echo "" >> table.md
          echo "| Platform | Problem | Link |" >> table.md
          echo "|----------|---------|------|" >> table.md

          # LeetCode
          if [ -d "leetcode" ]; then
            for dir in leetcode/*; do
              if [ -d "$dir" ]; then
                echo "| LeetCode | $(basename "$dir") | [ðŸ”—](./$dir) |" >> table.md
              fi
            done
          fi

          # Programmers
          if [ -d "programmers" ]; then
            for dir in programmers/*; do
              if [ -d "$dir" ]; then
                echo "| Programmers | $(basename "$dir") | [ðŸ”—](./$dir) |" >> table.md
              fi
            done
          fi

          # Baekjoon
          if [ -d "baekjoon" ]; then
            for dir in baekjoon/*; do
              if [ -d "$dir" ]; then
                echo "| Baekjoon | $(basename "$dir") | [ðŸ”—](./$dir) |" >> table.md
              fi
            done
          fi

      - name: Insert into README
        run: |
          if grep -q "<!-- ALL-PROBLEMS-START -->" README.md; then
            awk '
            BEGIN{flag=0}
            /<!-- ALL-PROBLEMS-START -->/{flag=1; print; system("cat table.md"); next}
            /<!-- ALL-PROBLEMS-END -->/{flag=0}
            !flag
            ' README.md > README.new
            mv README.new README.md
          else
            echo "Markers not found. Skipping update."
          fi

      - name: Commit changes
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

          git add README.md

          if git diff --cached --quiet; then
            echo "No changes to commit"
            exit 0
          fi

          git commit -m "docs: auto-update README table"
          git push