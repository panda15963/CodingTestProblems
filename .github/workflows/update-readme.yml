name: Auto Update README Table

on:
  push:
    branches: [main, master]

permissions:
  contents: write   # ðŸ”¥ ì´ ì¤„ í•„ìˆ˜

jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Generate table
        run: |
          echo "## ðŸ“Œ All Problems" > table.md
          echo "" >> table.md
          echo "| Platform | Problem | Link |" >> table.md
          echo "|----------|---------|------|" >> table.md

          for dir in leetcode/*; do
            [ -d "$dir" ] && echo "| LeetCode | $(basename "$dir") | [ðŸ”—](./$dir) |" >> table.md
          done

          for dir in programmers/*; do
            [ -d "$dir" ] && echo "| Programmers | $(basename "$dir") | [ðŸ”—](./$dir) |" >> table.md
          done

          for dir in baekjoon/*; do
            [ -d "$dir" ] && echo "| Baekjoon | $(basename "$dir") | [ðŸ”—](./$dir) |" >> table.md
          done

      - name: Insert into README
        run: |
          awk '
          BEGIN{flag=0}
          /<!-- ALL-PROBLEMS-START -->/{flag=1; print; system("cat table.md"); next}
          /<!-- ALL-PROBLEMS-END -->/{flag=0}
          !flag
          ' README.md > README.new

          mv README.new README.md

      - name: Commit changes
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add README.md
          git diff --cached --quiet || git commit -m "docs: auto-update README table"
          git push