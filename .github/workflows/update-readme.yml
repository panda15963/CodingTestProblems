name: ğŸš€ Advanced Auto Dashboard

on:
  push:
    branches: [main, master]

permissions:
  contents: write

jobs:
  update-readme:
    if: github.event.actor.name != 'github-actions[bot]'
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸ“Š Update Dashboard
        run: |
          # ì¹´ìš´íŠ¸ ê³„ì‚° (ê°„ë‹¨)
          LC=$(find leetcode -type d 2>/dev/null | wc -l)
          PR=$(find í”„ë¡œê·¸ë˜ë¨¸ìŠ¤ -type d 2>/dev/null | wc -l)
          BJ=$(find ë°±ì¤€ -type d 2>/dev/null | wc -l)
          
          # README ì§ì ‘ ìˆ˜ì •
          awk -v lc="$LC" -v pr="$PR" -v bj="$BJ" '
          /<!-- DASHBOARD-START -->/ {
            print "<!-- DASHBOARD-START -->"
            print "## ğŸ“Š Platform Statistics"
            print ""
            print "| Platform | Count |"
            print "|----------|-------|"
            print "| ğŸŸ¡ LeetCode | " lc " |"
            print "| ğŸ”µ Programmers | " pr " |"
            print "| ğŸŸ¢ Baekjoon | " bj " |"
            print "| ğŸ”¢ **Total** | " (lc+pr+bj) " |"
            print ""
            print "## ğŸ¥‡ Recently Solved (Top 5)"
            print ""
            system("git log --oneline -5 2>/dev/null | sed \"s/^/- /\" || echo \"- No commits\"")
            print "<!-- DASHBOARD-END -->"
            next
          }
          {print}
          ' README.md > tmp.md && mv tmp.md README.md

      - name: ğŸ’¾ Push
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add README.md
          git commit -m "ğŸš€ dashboard PR=$PR" || true
          git push || true
