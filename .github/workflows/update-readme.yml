name: ğŸš€ Advanced Auto Dashboard

on:
  push:
    branches: [main, master]

permissions:
  contents: write

jobs:
  update-readme:
    if: github.actor != 'github-actions[bot]'
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ“Š Generate Dashboard
        run: |
          # ì¹´ìš´íŠ¸ ê³„ì‚°
          LC=$(find leetcode -mindepth 1 -maxdepth 1 -type d 2>/dev/null | wc -l || echo 0)
          PR=0
          for D in í”„ë¡œê·¸ë˜ë¨¸ìŠ¤ programmers Programmers; do 
            [ -d "$D" ] && PR=$((PR+$(find "$D" -mindepth 1 -maxdepth 1 -type d 2>/dev/null | wc -l)))
          done
          BJ=0
          for D in ë°±ì¤€ baekjoon Baekjoon; do 
            [ -d "$D" ] && BJ=$((BJ+$(find "$D" -mindepth 1 -maxdepth 1 -type d 2>/dev/null | wc -l)))
          done
          TOTAL=$((LC+PR+BJ))
          
          echo "âœ… LC=$LC PR=$PR BJ=$BJ TOTAL=$TOTAL"
          
          # dashboard.md ìƒì„± (echoë§Œ ì‚¬ìš©)
          echo "## ğŸ“Š Platform Statistics" > dashboard.md
          echo "" >> dashboard.md
          echo "| Platform | Count |" >> dashboard.md
          echo "|----------|-------|" >> dashboard.md
          echo "| ğŸŸ¡ LeetCode | $LC |" >> dashboard.md
          echo "| ğŸ”µ Programmers | $PR |" >> dashboard.md
          echo "| ğŸŸ¢ Baekjoon | $BJ |" >> dashboard.md
          echo "| ğŸ”¢ **Total** | $TOTAL |" >> dashboard.md
          echo "" >> dashboard.md
          echo "## ğŸ¥‡ Recently Solved (Top 5)" >> dashboard.md
          echo "" >> dashboard.md
          git log -n 5 --oneline 2>/dev/null | sed 's/^/- /' >> dashboard.md || echo "- No commits" >> dashboard.md

      - name: ğŸ“ Insert to README
        run: |
          # DASHBOARD ë§ˆì»¤ í™•ì¸
          if ! grep -q "<!-- DASHBOARD-START -->" README.md; then
            echo "âŒ READMEì— DASHBOARD ë§ˆì»¤ ì¶”ê°€í•˜ì„¸ìš”!"
            exit 1
          fi
          
          # sedë¡œ êµì²´
          sed -i '/<!-- DASHBOARD-START -->/,/<!-- DASHBOARD-END -->/c<!-- DASHBOARD-START -->\n`cat dashboard.md`\n<!-- DASHBOARD-END -->' README.md
          sed -i "/<!-- DASHBOARD-START -->/,/<!-- DASHBOARD-END -->/{
          /<!-- DASHBOARD-START -->/r dashboard.md
          d
          }" README.md

      - name: ğŸ’¾ Commit & Push
        run: |
          git config --local user.name "github-actions[bot]"
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git add README.md
          
          if git diff --staged --quiet; then
            echo "â„¹ï¸ ë³€ê²½ì‚¬í•­ ì—†ìŒ"
          else
            git commit -m "ğŸš€ dashboard updated: PR=$PR"
            git push