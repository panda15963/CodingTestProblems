name: ðŸš€ Advanced Auto Dashboard

on:
  push:
    branches: [main, master]

permissions:
  contents: write

jobs:
  update-readme:
    if: github.event.actor.name != 'github-actions[bot]'
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ðŸ“Š Generate Dashboard
        run: |
          # ì¹´ìš´íŠ¸
          LC=$(find leetcode -mindepth 1 -maxdepth 1 -type d 2>/dev/null | wc -l || echo 0)
          PR=$(find í”„ë¡œê·¸ëž˜ë¨¸ìŠ¤ -mindepth 1 -maxdepth 1 -type d 2>/dev/null | wc -l || echo 0)
          PR=$((PR + $(find programmers -mindepth 1 -maxdepth 1 -type d 2>/dev/null | wc -l || echo 0)))
          BJ=$(find ë°±ì¤€ -mindepth 1 -maxdepth 1 -type d 2>/dev/null | wc -l || echo 0)
          TOTAL=$((LC+PR+BJ))
          
          echo "âœ… LC=$LC PR=$PR BJ=$BJ TOTAL=$TOTAL"
          
          # dashboard ìƒì„±
          printf "## ðŸ“Š Platform Statistics\n\n| Platform | Count |\n|----------|-------|\n| ðŸŸ¡ LeetCode | %s |\n| ðŸ”µ Programmers | %s |\n| ðŸŸ¢ Baekjoon | %s |\n| ðŸ”¢ **Total** | %s |\n\n## ðŸ¥‡ Recently Solved (Top 5)\n\n" "$LC" "$PR" "$BJ" "$TOTAL" > dashboard.md
          git log --oneline -5 2>/dev/null | sed 's/^/- /' >> dashboard.md || echo "- No commits" >> dashboard.md

      - name: ðŸ”„ Update README
        run: |
          sed -i '/<!-- DASHBOARD-START -->/,/<!-- DASHBOARD-END -->/c<!-- DASHBOARD-START -->\n$(cat dashboard.md)\n<!-- DASHBOARD-END -->' README.md

      - name: ðŸ’¾ Git Push
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add README.md
          git diff --staged --quiet || (git commit -m "ðŸš€ dashboard: PR=$PR" && git push)
